<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- GOOGLE FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet">
    <title>Catálogo</title>
    <link rel="stylesheet" href="css/catalogo.css">
    <link rel="stylesheet" href="css/navbar.css">
</head>

<body>
    <!-- CABEÇALHO -->
    <!---------------NAVBAR-------------------------------------------------->
    <div class="navbar-caixa">
        <div class="conteudo-nav">
            <div class="texto-nav">Estoque Real e Inventário</div>

            <button id="menu-btn" class="menu-btn">&#9776;</button>
        </div>

        <!--------------------------------HAMBURGUER------------------------------------------------------------------------------------>
        <div id="sidebar" class="sidebar">
            <button id="close-btn" class="close-btn">&times;</button>
            <img src="imglogineusuario/senaibranco.svg" alt="" />
            <h3>Menu</h3>
            <ul>


                <li class="home">
                    <a href="telaInicial.html" id="home">
                        <div class="home"></div>
                        <span>Home</span>
                    </a>
                </li>


                <li class="cadastrar">
                    <a href="cadastro1.html" id="cadas">
                        <div class="box-of-good-good"></div>
                        <span>Cadastrar</span>
                    </a>
                </li>


                <li class="edicao">
                    <a href="edicao.html" id="edicao">
                        <div class="pencil"></div>
                        <span>Edição</span>
                    </a>
                </li>


                <li class="estoque-item">
                    <a href="#" id="esto" class="estoque-link">
                        <div class="boxes-of-good-good"></div>
                        <span>Estoque</span>
                    </a>
                    <ul id="estoque-submenu" class="submenu">
                        <li><a href="catalogo.html">Catálogo</a></li>
                        <li><a href="estoque_real.html">Estoque Real e Inventário</a></li>
                        <li><a href="layout.html">Layout do Estoque</a></li>
                    </ul>
                </li>


                <li class="financeiro">
                    <a href="financeiro.html" id="finan">
                        <div class="financial"></div>
                        <span>Financeiro</span>
                    </a>
                </li>
            </ul>

            <div class="container-logos">
                <h4>SGA - Sistema de Gerenciamento de Armazém</h4>
                <img src="imagens/logo-emp.svg" id="logo-gato" alt="" /><img src="imagens/logo-soft.svg"
                    id="logo-cubo" />
            </div>
        </div>
    </div>
    <!-------------------------------------------------------------------------------------------------------------------------------->

    <div id="barradebusca">
        <div id="filtrarcontainer">
            <div class="div_pesquisa">
                <button id="filtrar"><img src="imagens/filtro.svg" alt="Filtro" id="fil">Filtrar</button>
            </div>
            <div id="caixote">
                <form id="formFiltrar">
                    <div id="ajeitar">
                        <div id="subajeitada">
                            <span>Filtros</span>
                            <div id="textinho" onclick="limparFiltros()">
                                Limpar Filtros
                            </div>
                        </div>
                        <div id="dropdown" class="dentrodropdown">
                            <label for="categoria">Categoria:</label>
                            <select id="categoria" name="categoria">
                                <option value="">Selecione Categoria</option>
                                <!-- Adicione as opções dinamicamente via JavaScript -->
                            </select>
                            <label for="fabricante">Fabricante:</label>
                            <select id="fabricante" name="fabricante">
                                <option value="">Selecione Fabricante</option>
                                <!-- Adicione os fabricantes dinamicamente via JavaScript -->
                            </select>
                        </div>
                        <!-- <div id="inputdata">
                            <label>Data:</label>
                            <div id="ajeitardata">
                                <input type="date" id="dedata" name="dedata" class="datasize">
                                à
                                <input type="date" id="atedata" name="atedata" class="datasize">
                            </div>
                        </div> -->
                        <div id="ordernaritem">
                            <label>Ordenar Item:</label>
                            <div id="ordenar">  
                                <select id="ordenacao">
                                    <option value="">Order Por:</option>
                                    <option value="az">A - Z</option>
                                    <option value="za">Z - A</option>
                                    <option value="maisRecente">Mais Recente</option>
                                    <option value="maisAntigo">Mais Antigo</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <button type="submit" id="filtrarBtn">Filtrar</button>
                </form>
            </div>
        </div>
    
  
        <!-- acabou as mudanças -->
        <form id="formPesquisa">
            <div class="div_pesquisa">
                <input type="text" id="codigo">
                <button id="pesquisar">Pesquisar <img src="imagens/lupa.svg" alt="" id="pes"></button>
            </div>
        </form>
    </div>

    <div class="container">
        <div class="content-table">
            <table id="tabela-estoque">

                <thead>
                    <tr id="cabecalho-table">
                        <th>CODIGO</th>
                        <th>ITEM</th>
                        <th>ESTOQUE DE SEGURANÇA</th>
                        <th>ENTRADA</th>
                        <th>TOTAL</th>
                        <th>INVENTARIO</th>
                        <th>PERCENTUAL</th>
                        <th>STATUS</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>


            </table>
        </div>
    </div>

    <div class="footer">
        <img src="imgCADASTRO/gatinhoRodapé.svg" alt="">
    </div>

    <script>
        // HAMBURGUER
        document.addEventListener('DOMContentLoaded', function () {

            const estoqueItem = document.querySelector('.estoque-item');
            const estoqueSubMenu = document.getElementById('estoque-submenu');
            const estoqueLink = document.getElementById('esto');
            const iconeEstoque = estoqueLink.querySelector('.boxes-of-good-good');

            const submenuLinks = estoqueSubMenu.querySelectorAll('a');
            submenuLinks.forEach(link => {
                link.addEventListener('click', function (event) {
                    event.stopPropagation();
                });
            });

            estoqueItem.addEventListener('click', function (event) {
                event.preventDefault();

                estoqueItem.classList.toggle('active');
                if (estoqueItem.classList.contains('active')) {
                    estoqueSubMenu.style.display = "block";
                    estoqueItem.style.backgroundColor = "#000";
                    estoqueLink.style.color = "#319DF6";
                    iconeEstoque.style.backgroundImage = "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cpath fill='%23319df6' d='M10 4v11h12V4zm2 2h2v4l2-2l2 2V6h2v7h-8zM3 17v11h12V17zm14 0v11h12V17zM5 19h2v4l2-2l2 2v-4h2v7H5zm14 0h2v4l2-2l2 2v-4h2v7h-8z'/%3E%3C/svg%3E\")";
                } else {
                    estoqueSubMenu.style.display = "none";
                    estoqueItem.style.backgroundColor = "";
                    estoqueLink.style.color = "";
                    iconeEstoque.style.backgroundImage = "";
                }
            });

            // Fecha o dropdown ao clicar fora
            document.addEventListener('click', function (event) {
                if (!estoqueItem.contains(event.target)) {
                    estoqueItem.classList.remove('active');
                    estoqueSubMenu.style.display = "none";
                    estoqueItem.style.backgroundColor = "";
                    estoqueLink.style.color = "";
                    iconeEstoque.style.backgroundImage = "";
                }
            });


        });

        //SCRIPT QUE LIGA OS INPUT AO BACK-END  
  //SCRIPT QUE LIGA OS INPUT AO BACK-END   
  document.getElementById('formPesquisa').addEventListener('submit', async function (event) {
    event.preventDefault(); // Evita o comportamento padrão do formulário

    const pesquisa = {
        codigo: document.getElementById('codigo').value,  // Obtendo o valor do campo 'codigo'
    };

    try {
        const response = await fetch('http://localhost:3000/estoque-real', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(pesquisa), // Envia os dados para o backend
        });

        if (response.ok) {
            const produtos = await response.json();  // Resposta em formato JSON

            if (produtos.length === 0) {
                alert('Nenhum produto encontrado!');
                return;
            }

            const tbody = document.querySelector('#tabela-estoque tbody');
            tbody.innerHTML = '';  // Limpa a tabela antes de adicionar novos dados

            produtos.forEach((filtrado) => {
                const row = `
                 <tr>
                    <td>${filtrado.CODIGO}</td>
                    <td>${filtrado.NOME_BASICO}</td>
                    <td>50</td>
                    <td>${filtrado.QUANT_RECENTE}</td>
                    <td>${filtrado.QUANTIDADE}</td>
                    <td>${filtrado.QUANTIDADE}</td>
                    <td>100%</td>
                    <td>OK</td>
                </tr>
                `;
                tbody.innerHTML += row;  // Adiciona a linha à tabela
            });
        } else {
            const errorMessage = await response.text();
            alert('Erro: ' + errorMessage);
        }
    } catch (error) {
        alert('Erro ao buscar produtos: ' + error.message);
    }
});


    </script>

<script>

document.getElementById('formFiltrar').addEventListener('submit', async (event) => {
    event.preventDefault(); // Impede o recarregamento da página

    const fabricante = document.getElementById('fabricante').value;
    const codigo = document.getElementById('codigo').value;
    const ordenacao = document.getElementById('ordenacao').value; // Captura a ordenação

    try {
        const response = await fetch('/filtro-catalogo', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ fabricante, codigo, ordenacao }) // Envia ordenação
        });

        if (response.ok) {
            const produtosFiltrados = await response.json();

            const tbody = document.querySelector('#tabela-estoque tbody');
            tbody.innerHTML = ''; // Limpa os dados antigos

            produtosFiltrados.forEach(filtrado => {     
                const row = `
                <tr>
                    <td>${filtrado.CODIGO}</td>
                    <td>${filtrado.NOME_BASICO}</td>
                    <td>50</td>
                    <td>${filtrado.QUANT_RECENTE}</td>
                    <td>${filtrado.QUANTIDADE}</td>
                    <td>${filtrado.QUANTIDADE}</td>
                    <td>100%</td>
                    <td>OK</td>
                </tr>
              `

              tbody.innerHTML += row;  

            });
        } else {
            console.error('Erro ao obter produtos:', await response.text());
        }
    } catch (error) {
        console.error('Erro na requisição:', error);
    }
});


</script>






    <script src="../app.js"></script>
    <script src="js/estoque_real.js"></script>
    <script src="js/navbar.js"></script>


</body>

</html>
<script>
 
    document.getElementById('formFiltrar').addEventListener('submit', async (event) => {
       event.preventDefault(); // Impede o recarregamento da página
   
       const fabricante = document.getElementById('fabricanteFiltro').value;
       const codigo = document.getElementById('codigo').value;
       const ordenacao = document.getElementById('ordenacao').value; // Captura a ordenação
   
       try {
           const response = await fetch('/filtro-catalogo', {
               method: 'POST',
               headers: { 'Content-Type': 'application/json' },
               body: JSON.stringify({ fabricante, codigo, ordenacao }) // Envia os dados ao backend
           });
   
           if (response.ok) {
               const produtosFiltrados = await response.json();
   
               const tbody = document.querySelector('#tabela-estoque tbody');
               tbody.innerHTML = ''; // Limpa os dados antigos
   
               if (produtosFiltrados.length === 0) {
                   tbody.innerHTML = '<tr><td colspan="7">Nenhum produto encontrado</td></tr>';
                   return;
               }
   
               produtosFiltrados.forEach(filtrado => {     
                   const row = `
                       <tr id="produto-${filtrado.CODIGO}">
                           <td>${filtrado.CODIGO}</td>
                           <td>${filtrado.NOME_BASICO}</td>
                           <td>${filtrado.DESCRICAO_TECNICA}</td>
                           <td>${filtrado.QUANT}</td>
                           <td>${filtrado.CATEGORIA || 'Indefinido'}</td>
                           <td>${filtrado.FABRICANTE}</td>
                           <td class="lixeira">
                               <img src="imagens/Lixeira(Normal).svg" alt="Lixeira" class="imagemlixeira" onmouseover="this.src='imagens/Lixeira(Modificado).svg';" onmouseout="this.src='imagens/Lixeira(Normal).svg';" onclick="excluirProduto(${filtrado.CODIGO})">
                           </td>
                           <td class="lapis">
                               <img src="imagens/Lapis(Normal).svg" alt="Lápis" class="imagemlapis" onmouseover="this.src='imagens/Lapis(Modificado).svg';" onmouseout="this.src='imagens/Lapis(Normal).svg';">
                           </td>
                       </tr>
                   `;
                   tbody.innerHTML += row;
               });
           } else {
               console.error('Erro ao obter produtos:', await response.text());
           }
       } catch (error) {
           console.error('Erro na requisição:', error);
       }
   });
   
   </script>
   
   <!---->
   
   <script>
       
    document.getElementById('formPesquisa').addEventListener('submit', async function (event) {
       event.preventDefault(); // Evita o comportamento padrão do formulário
   
       const pesquisa = {
           codigo: document.getElementById('codigo').value,  // Obtendo o valor do campo 'codigo'
       };
   
       try {
           const response = await fetch('http://localhost:3000/ver-catalogo', {
               method: 'POST',
               headers: { 'Content-Type': 'application/json' },
               body: JSON.stringify(pesquisa), // Envia os dados para o backend
           });
   
           if (response.ok) {
               const produtos = await response.json();  // Resposta em formato JSON
   
               if (produtos.length === 0) {
                   alert('Nenhum produto encontrado!');
                   return;
               }
   
               const tbody = document.querySelector('#tabela-estoque tbody');
               tbody.innerHTML = '';  // Limpa a tabela antes de adicionar novos dados
   
               produtos.forEach((produto) => {
                   const row = `
                   <tr>
                       <td>${produto.CODIGO}</td>
                       <td>${produto.NOME_BASICO}</td>
                       <td>${produto.DESCRICAO_TECNICA}</td>
                       <td>${produto.QUANT}</td>
                       <td>${produto.CATEGORIA}</td>
                       <td>${produto.FABRICANTE}</td>
                       <td class="colunaAbrirDetalhes" id="${produto.CODIGO}">
                           <button onclick="abrirLinha()" class="btnAbrirLinha" id="${produto.CODIGO}">+</button>
                       </td>
                   </tr>
                   <tr id="linhaDetalhe" style="display: none;">
                       <td colspan="6">
                           <div class="containerLinhaOculta">
                               <div class="containerLinhaDetalhes">
                                   <div class="imagemProduto">
                                       <img src="https://img.kalunga.com.br/fotosdeprodutos/124209d.jpg" alt="" id="imagemLinhaDetalhe">
                                   </div>
                                   <div class="endereco-obs">
                                       <table>
                                           <thead>
                                               <th colspan="2">Endereçamento</th>
                                           </thead>
                                           <tbody id="tableEnderecamento">
                                               <tr>
                                                   <td id="colunaTopico" class="celulaDetalhe">Rua</td>
                                                   <td class="celulaDetalhe">${produto.RUA}</td>
                                               </tr>
                                               <tr>
                                                   <td id="colunaTopico" class="celulaDetalhe">Coluna</td>
                                                   <td class="celulaDetalhe">${produto.COLUNA}</td>
                                               </tr>
                                               <tr>
                                                   <td id="colunaTopico" class="celulaDetalhe">Andar</td>
                                                   <td class="celulaDetalhe">${produto.ANDAR}</td>
                                               </tr>
                                           </tbody>
                                       </table>
                                       <table>
                                            <thead>
                                               <th id="tableObservacoes">Observações</th>
                                           </thead>
                                           <tbody>
                                               <tr>
                                                   <td id="celulaObservacoes">${produto.OBSERVACOES_ADICIONAL}</td>
                                               </tr>
                                           </tbody>
                                       </table>
                                   </div>
                                   <div class="caractProd">
                                       <table>
                                       <thead>
                                           <th colspan="2">Características</th>
                                       </thead>
                                       <tbody id="tableCaracter">
                                           <tr>
                                               <td id="colunaTopico">Largura</td>
                                               <td class="celulaDetalhe">${produto.LARGURA} cm</td>
                                           </tr>
                                           <tr>
                                               <td id="colunaTopico">Altura</td>
                                               <td class="celulaDetalhe">${produto.ALTURA} cm</td>
                                           </tr>
                                           <tr>
                                               <td id="colunaTopico">Profundidade</td>
                                               <td class="celulaDetalhe">${produto.PROFUNDIDADE} cm</td>
                                           </tr>
                                           <tr>
                                               <td id="colunaTopico">Peso</td>
                                               <td class="celulaDetalhe">${produto.PESO} Kg</td>
                                           </tr>
                                           <tr>
                                               <td id="colunaTopico">Frágil</td>
                                               <td class="celulaDetalhe">${produto.FRAGILIDADE}</td>
                                           </tr>
                                       </tbody>
                                       </table>
                                   </div>
                               </div>
                           </div>
                       </td>
                   </tr>
                   `;
                   tbody.innerHTML += row;  // Adiciona a linha à tabela
               });
           } else {
               const errorMessage = await response.text();
               alert('Erro: ' + errorMessage);
           }
       } catch (error) {
           alert('Erro ao buscar produtos: ' + error.message);
       }
   });
   
   
   </script>